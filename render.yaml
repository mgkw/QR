services:
  - type: web
    name: qr-scanner-global
    runtime: python3
    buildCommand: pip install -r requirements.txt
    startCommand: gunicorn app:app --bind 0.0.0.0:$PORT --workers 2 --timeout 120
    plan: free
    env: python
    region: oregon
    branch: main
    healthCheckPath: /api/health
    preDeployCommand: python setup_database.py
    
    # Environment Variables (متغيرات البيئة)
    envVars:
      - key: FLASK_ENV
        value: production
      - key: SECRET_KEY
        generateValue: true
      - key: PYTHONUNBUFFERED
        value: "1"
      - key: PORT
        value: "10000"
      # Database URLs (ستتم إضافتها يدوياً في Dashboard)
      # - key: DATABASE_URL
      #   fromDatabase:
      #     name: qr-scanner-db
      #     property: connectionString
      
    # Auto Deploy Settings
    autoDeploy: true
    
    # Build Settings
    buildFilter:
      paths:
      - "**"
      ignoredPaths:
      - "*.md"
      - ".git/**"
      - "node_modules/**"
      
    # Health Check
    healthCheck:
      httpPath: /api/health
      initialDelaySeconds: 30
      timeoutSeconds: 10
      
    # Resource Settings
    disk:
      name: data
      mountPath: /data
      sizeGB: 1

  # PostgreSQL Database (اختياري - يمكن استخدام قواعد بيانات خارجية)
  # - type: pserv
  #   name: qr-scanner-db
  #   runtime: postgres
  #   plan: free
  #   databaseName: qr_scanner
  #   databaseUser: qr_admin
  #   region: oregon 