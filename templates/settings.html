<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª - Ù‚Ø§Ø±Ø¦ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø§Ù„Ù…ØªØ·ÙˆØ±</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        * { font-family: 'Cairo', sans-serif; }
        body { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
        .navbar { background: linear-gradient(135deg, #4CAF50, #2196F3) !important; }
        .card { border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); border: none; margin-bottom: 2rem; }
        .card-header { background: linear-gradient(135deg, #4CAF50, #2196F3); color: white; border-radius: 15px 15px 0 0 !important; }
        .form-control, .form-select { border-radius: 10px; border: 2px solid #e0e0e0; padding: 12px 15px; }
        .form-control:focus, .form-select:focus { border-color: #4CAF50; box-shadow: 0 0 0 0.2rem rgba(76, 175, 80, 0.25); }
        .btn-save { background: linear-gradient(135deg, #4CAF50, #45a049); border: none; color: white; border-radius: 50px; padding: 12px 30px; }
        .btn-test { background: linear-gradient(135deg, #2196F3, #1976d2); border: none; color: white; border-radius: 50px; padding: 8px 20px; }
        .setting-group { background: #f8f9fa; border-radius: 10px; padding: 1.5rem; margin-bottom: 1.5rem; border-right: 4px solid #4CAF50; }
        .telegram-status { padding: 10px 15px; border-radius: 8px; margin-top: 10px; font-weight: 600; }
        .telegram-status.connected { background: #e8f5e8; color: #4CAF50; border: 1px solid #4CAF50; }
        .telegram-status.disconnected { background: #ffe6e6; color: #f44336; border: 1px solid #f44336; }
        .notification { position: fixed; top: 20px; right: 20px; background: #4CAF50; color: white; padding: 15px 20px; border-radius: 15px; z-index: 1001; transform: translateX(400px); transition: all 0.3s; }
        .notification.show { transform: translateX(0); }
        .notification.error { background: #f44336; }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="/"><i class="fas fa-qrcode"></i> Ù‚Ø§Ø±Ø¦ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø§Ù„Ù…ØªØ·ÙˆØ±</a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/"><i class="fas fa-home"></i> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
                <a class="nav-link" href="/dashboard"><i class="fas fa-chart-bar"></i> Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <!-- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ØªÙ„ÙŠØ¬Ø±Ø§Ù… Ø§Ù„Ø«Ø§Ø¨ØªØ© -->
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="fab fa-telegram"></i> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ØªÙ„ÙŠØ¬Ø±Ø§Ù… (Ø«Ø§Ø¨ØªØ©)</h5>
                    </div>
                    <div class="card-body">
                        <div class="setting-group">
                            <h6><i class="fas fa-lock"></i> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¨ÙˆØª Ø§Ù„Ù…ÙØ¹Ø¯Ø© Ù…Ø³Ø¨Ù‚Ø§Ù‹</h6>
                            
                            <div class="alert alert-success">
                                <i class="fas fa-check-circle"></i>
                                <strong>ØªÙ… Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…!</strong> Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø«Ø§Ø¨ØªØ© ÙˆÙ…ÙØ¹Ø¯Ø© Ù…Ø³Ø¨Ù‚Ø§Ù‹ ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚.
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© (Chat ID)</label>
                                <input type="text" class="form-control" id="fixedChatId" readonly>
                                <div class="form-text">Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ù…ÙØ¹Ø¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹</div>
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Ø±Ù…Ø² Ø§Ù„Ø¨ÙˆØª (Bot Token)</label>
                                <input type="text" class="form-control" id="fixedBotToken" readonly>
                                <div class="form-text">Ø±Ù…Ø² Ø§Ù„Ø¨ÙˆØª Ø§Ù„Ù…ÙØ¹Ø¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹ (Ù…Ø®ÙÙŠ Ø¬Ø²Ø¦ÙŠØ§Ù‹ Ù„Ø£ØºØ±Ø§Ø¶ Ø§Ù„Ø£Ù…Ø§Ù†)</div>
                            </div>

                            <div class="d-flex gap-2">
                                <button class="btn btn-test" id="testTelegramFixedBtn">
                                    <i class="fas fa-paper-plane"></i> Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
                                </button>
                                <button class="btn btn-info" id="checkTelegramBtn">
                                    <i class="fas fa-info-circle"></i> ÙØ­Øµ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¨ÙˆØª
                                </button>
                                <button class="btn btn-warning" id="diagnoseTelegramBtn">
                                    <i class="fas fa-stethoscope"></i> ØªØ´Ø®ÙŠØµ Ù…ÙØµÙ„
                                </button>
                            </div>

                            <div id="telegramStatusFixed" class="telegram-status connected">
                                <i class="fas fa-check-circle"></i> Ù…ÙØ¹Ø¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹ ÙˆØ¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø§Ø³Ø­ -->
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="fas fa-camera"></i> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø§Ø³Ø­</h5>
                    </div>
                    <div class="card-body">
                        <div class="setting-group">
                            <h6><i class="fas fa-cogs"></i> Ø³Ù„ÙˆÙƒ Ø§Ù„Ù…Ø³Ø­</h6>
                            
                            <div class="mb-3">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="scannerContinuous" checked>
                                    <label class="form-check-label" for="scannerContinuous">Ø§Ù„Ù…Ø³Ø­ Ø§Ù„Ù…Ø³ØªÙ…Ø±</label>
                                </div>
                                <div class="form-text">Ø¹Ù†Ø¯ Ø§Ù„ØªÙØ¹ÙŠÙ„ØŒ Ø³ÙŠØ³ØªÙ…Ø± Ø§Ù„Ù…Ø³Ø­ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ø¹Ø¯ ÙƒÙ„ Ù†ØªÙŠØ¬Ø©</div>
                            </div>

                            <div class="mb-3">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="scannerSound" checked>
                                    <label class="form-check-label" for="scannerSound">Ø§Ù„ØµÙˆØª Ø¹Ù†Ø¯ Ø§Ù„Ù…Ø³Ø­</label>
                                </div>
                                <div class="form-text">ØªØ´ØºÙŠÙ„ ØµÙˆØª ØªÙ†Ø¨ÙŠÙ‡ Ø¹Ù†Ø¯ Ø§ÙƒØªØ´Ø§Ù Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø¬Ø¯ÙŠØ¯</div>
                            </div>

                            <div class="mb-3">
                                <label for="duplicateDelay" class="form-label">ØªØ£Ø®ÙŠØ± Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø± (Ø¨Ø§Ù„Ø«ÙˆØ§Ù†ÙŠ)</label>
                                <input type="range" class="form-range" id="duplicateDelay" min="1" max="10" value="3" step="1">
                                <div class="d-flex justify-content-between text-muted small">
                                    <span>1 Ø«Ø§Ù†ÙŠØ©</span>
                                    <span id="delayValue">3 Ø«ÙˆØ§Ù†ÙŠ</span>
                                    <span>10 Ø«ÙˆØ§Ù†ÙŠ</span>
                                </div>
                                <div class="form-text">Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ø¨ÙŠÙ† Ù…Ø³Ø­ Ù†ÙØ³ Ø§Ù„ÙƒÙˆØ¯ Ù„Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø±</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ -->
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="fas fa-palette"></i> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</h5>
                    </div>
                    <div class="card-body">
                        <div class="setting-group">
                            <h6><i class="fas fa-text-width"></i> Ø§Ù„Ø¹Ø±Ø¶ ÙˆØ§Ù„ØªØ®ØµÙŠØµ</h6>
                            
                            <div class="mb-3">
                                <label for="appTitle" class="form-label">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</label>
                                <input type="text" class="form-control" id="appTitle" value="Ù‚Ø§Ø±Ø¦ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø§Ù„Ù…ØªØ·ÙˆØ±">
                                <div class="form-text">Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø°ÙŠ ÙŠØ¸Ù‡Ø± ÙÙŠ Ø£Ø¹Ù„Ù‰ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</div>
                            </div>

                            <div class="mb-3">
                                <label for="themeColor" class="form-label">Ù„ÙˆÙ† Ø§Ù„Ø³Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</label>
                                <div class="d-flex align-items-center gap-3">
                                    <input type="color" class="form-control" id="themeColor" value="#4CAF50" style="width: 80px; height: 40px;">
                                    <span class="text-muted">Ø§Ø®ØªØ± Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ù…ÙØ¶Ù„ Ù„Ù„ÙˆØ§Ø¬Ù‡Ø©</span>
                                </div>
                            </div>
                        </div>

                        <div class="setting-group">
                            <h6><i class="fas fa-database"></i> Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h6>
                            
                            <div class="mb-3">
                                <div class="row">
                                    <div class="col-md-6">
                                        <button class="btn btn-info w-100" id="backupBtn">
                                            <i class="fas fa-download"></i> Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠ
                                        </button>
                                    </div>
                                    <div class="col-md-6">
                                        <button class="btn btn-warning w-100" id="clearBtn">
                                            <i class="fas fa-trash"></i> Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                                        </button>
                                    </div>
                                </div>
                                <div class="form-text">Ø¥Ø¯Ø§Ø±Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø­ÙØ¸ -->
                <div class="text-center">
                    <button class="btn btn-save btn-lg" id="saveSettingsBtn">
                        <i class="fas fa-save"></i> Ø­ÙØ¸ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i> ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­!
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let currentSettings = {};

        document.addEventListener('DOMContentLoaded', () => {
            loadSettings();
            loadTelegramInfo();
            setupEventListeners();
        });

        function setupEventListeners() {
            const duplicateDelayRange = document.getElementById('duplicateDelay');
            const delayValue = document.getElementById('delayValue');
            
            duplicateDelayRange.addEventListener('input', () => {
                const value = duplicateDelayRange.value;
                delayValue.textContent = value + (value == 1 ? ' Ø«Ø§Ù†ÙŠØ©' : ' Ø«ÙˆØ§Ù†ÙŠ');
            });

            document.getElementById('saveSettingsBtn').addEventListener('click', saveSettings);
            document.getElementById('testTelegramFixedBtn').addEventListener('click', testTelegramFixed);
            document.getElementById('checkTelegramBtn').addEventListener('click', checkTelegramBot);
            document.getElementById('diagnoseTelegramBtn').addEventListener('click', diagnoseTelegram);
            document.getElementById('backupBtn').addEventListener('click', backupDatabase);
            document.getElementById('clearBtn').addEventListener('click', clearDatabase);
        }

        async function loadSettings() {
            try {
                const response = await fetch('/api/settings');
                const data = await response.json();
                
                if (data.success) {
                    currentSettings = data.settings;
                    populateForm(currentSettings);
                    updateTelegramStatus();
                }
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª:', error);
                showNotification('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª: ' + error.message, 'error');
            }
        }

        function populateForm(settings) {
            document.getElementById('scannerContinuous').checked = settings.scanner_continuous === 'true';
            document.getElementById('scannerSound').checked = settings.scanner_sound === 'true';
            document.getElementById('duplicateDelay').value = parseInt(settings.scanner_duplicate_delay) / 1000 || 3;
            document.getElementById('appTitle').value = settings.app_title || 'Ù‚Ø§Ø±Ø¦ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø§Ù„Ù…ØªØ·ÙˆØ±';
            document.getElementById('themeColor').value = settings.theme_color || '#4CAF50';

            const delayValue = document.getElementById('delayValue');
            const delay = parseInt(settings.scanner_duplicate_delay) / 1000 || 3;
            delayValue.textContent = delay + (delay == 1 ? ' Ø«Ø§Ù†ÙŠØ©' : ' Ø«ÙˆØ§Ù†ÙŠ');
        }

        async function loadTelegramInfo() {
            try {
                const response = await fetch('/api/telegram/info');
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('fixedChatId').value = data.chat_id;
                    document.getElementById('fixedBotToken').value = data.bot_token_preview;
                }
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…:', error);
                showNotification('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…', 'error');
            }
        }

        async function saveSettings() {
            try {
                const settings = {
                    scanner_continuous: document.getElementById('scannerContinuous').checked.toString(),
                    scanner_sound: document.getElementById('scannerSound').checked.toString(),
                    scanner_duplicate_delay: (parseInt(document.getElementById('duplicateDelay').value) * 1000).toString(),
                    app_title: document.getElementById('appTitle').value.trim(),
                    theme_color: document.getElementById('themeColor').value
                };

                const response = await fetch('/api/settings', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(settings)
                });

                const result = await response.json();
                
                if (result.success) {
                    currentSettings = {...currentSettings, ...settings};
                    showNotification('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                } else {
                    showNotification('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª: ' + result.error, 'error');
                }

            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª:', error);
                showNotification('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…', 'error');
            }
        }

        async function testTelegramFixed() {
            try {
                const response = await fetch('/api/scan', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        code_data: 'TEST_MESSAGE_' + Date.now(),
                        code_type: 'test',
                        notes: 'Ø±Ø³Ø§Ù„Ø© Ø§Ø®ØªØ¨Ø§Ø± Ù…Ù† ØµÙØ­Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª - Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø«Ø§Ø¨ØªØ©'
                    })
                });

                const result = await response.json();
                
                if (result.success && result.telegram_sent) {
                    showNotification('âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                    updateTelegramStatusFixed('success');
                } else {
                    showNotification('âŒ ÙØ´Ù„ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±', 'error');
                    updateTelegramStatusFixed('error');
                }

            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ø®ØªØ¨Ø§Ø± ØªÙ„ÙŠØ¬Ø±Ø§Ù…:', error);
                showNotification('Ø®Ø·Ø£ ÙÙŠ Ø§Ø®ØªØ¨Ø§Ø± ØªÙ„ÙŠØ¬Ø±Ø§Ù…: ' + error.message, 'error');
                updateTelegramStatusFixed('error');
            }
        }

        async function checkTelegramBot() {
            try {
                const response = await fetch('/api/telegram/test');
                const result = await response.json();
                
                if (result.success) {
                    showNotification(`âœ… Ø§Ù„Ø¨ÙˆØª Ù…ØªØµÙ„! Ø§Ù„Ø§Ø³Ù…: @${result.bot_name}`, 'success');
                    updateTelegramStatusFixed('connected');
                } else {
                    showNotification('âŒ ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¨ÙˆØª: ' + result.error, 'error');
                    updateTelegramStatusFixed('error');
                }

            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ÙØ­Øµ Ø§Ù„Ø¨ÙˆØª:', error);
                showNotification('Ø®Ø·Ø£ ÙÙŠ ÙØ­Øµ Ø§Ù„Ø¨ÙˆØª: ' + error.message, 'error');
                updateTelegramStatusFixed('error');
            }
        }

        async function diagnoseTelegram() {
            try {
                showNotification('Ø¬Ø§Ø±Ù ØªØ´Ø®ÙŠØµ Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…...', 'info');
                
                const response = await fetch('/api/diagnostics/telegram', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });

                const result = await response.json();
                
                if (result.success) {
                    const details = `
âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­!

ğŸ“Š ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªØ´Ø®ÙŠØµ:
â€¢ Ø§Ù„Ø¨ÙˆØª: @${result.bot_info.bot_name}
â€¢ Ù…Ø¹Ø±Ù Ø§Ù„Ø¨ÙˆØª: ${result.bot_info.bot_id}
â€¢ Ù…Ø¹Ø±Ù Ø§Ù„Ø±Ø³Ø§Ù„Ø©: ${result.send_result.message_id}
â€¢ Ø²Ù…Ù† Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©: ${(result.response_time * 1000).toFixed(0)}ms
â€¢ Ø§Ù„ØªØ§Ø±ÙŠØ®: ${new Date(result.send_result.date * 1000).toLocaleString('ar-SA')}

ğŸ¯ Ø§Ù„Ø­Ø§Ù„Ø©: Ù…Ù…ØªØ§Ø²Ø© - Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ù†Ø¬Ø­Øª
                    `;
                    
                    showNotification(details, 'success');
                    updateTelegramStatusFixed('success');
                } else {
                    const errorDetails = `
âŒ ÙØ´Ù„ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…

ğŸ” ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø®Ø·Ø£:
${result.error}

ğŸ’¡ Ø§Ù„Ø­Ù„ÙˆÙ„ Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©:
â€¢ ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ØªØµØ§Ù„ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª
â€¢ Ø¬Ø±Ø¨ Ø§Ø³ØªØ®Ø¯Ø§Ù… VPN Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù… Ù…Ø­Ø¬ÙˆØ¨
â€¢ ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ø¨ÙˆØª Ù…Ø¶Ø§Ù Ù„Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©
â€¢ Ø§Ù†ØªØ¸Ø± Ø¯Ù‚ÙŠÙ‚Ø© ÙˆØ­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰
                    `;
                    
                    showNotification(errorDetails, 'error');
                    updateTelegramStatusFixed('error');
                }

            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ´Ø®ÙŠØµ Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…:', error);
                showNotification(`Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ´Ø®ÙŠØµ: ${error.message}`, 'error');
                updateTelegramStatusFixed('error');
            }
        }

        function updateTelegramStatusFixed(status = 'connected') {
            const statusEl = document.getElementById('telegramStatusFixed');
            
            if (status === 'success') {
                statusEl.className = 'telegram-status connected';
                statusEl.innerHTML = '<i class="fas fa-check-circle"></i> ØªÙ… Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­ - Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¥Ø±Ø³Ø§Ù„';
            } else if (status === 'error') {
                statusEl.className = 'telegram-status disconnected';
                statusEl.innerHTML = '<i class="fas fa-exclamation-circle"></i> Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ - ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª';
            } else {
                statusEl.className = 'telegram-status connected';
                statusEl.innerHTML = '<i class="fas fa-check-circle"></i> Ù…ÙØ¹Ø¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹ ÙˆØ¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…';
            }
        }

        function backupDatabase() {
            window.open('/api/export?format=json', '_blank');
            showNotification('ØªÙ… Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©', 'success');
        }

        function clearDatabase() {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡!')) {
                showNotification('Ù…ÙŠØ²Ø© Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø³ØªØªÙˆÙØ± Ù‚Ø±ÙŠØ¨Ø§Ù‹', 'info');
            }
        }

        function showNotification(message, type = 'success') {
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
            const existingNotifications = document.querySelectorAll('.notification-custom');
            existingNotifications.forEach(notif => notif.remove());
            
            // Ø¥Ù†Ø´Ø§Ø¡ ØªÙ†Ø¨ÙŠÙ‡ Ø¬Ø¯ÙŠØ¯
            const notification = document.createElement('div');
            notification.className = `notification-custom alert alert-${type === 'error' ? 'danger' : type === 'info' ? 'info' : 'success'} alert-dismissible`;
            notification.style.cssText = `
                position: fixed; 
                top: 20px; 
                right: 20px; 
                z-index: 1060; 
                min-width: 350px;
                max-width: 500px;
                border-radius: 15px;
                box-shadow: 0 4px 20px rgba(0,0,0,0.15);
                white-space: pre-line;
                font-family: 'Cairo', sans-serif;
            `;
            
            notification.innerHTML = `
                <div class="d-flex align-items-start">
                    <i class="fas fa-${type === 'error' ? 'exclamation-circle' : type === 'info' ? 'info-circle' : 'check-circle'} me-2 mt-1"></i>
                    <div style="flex: 1; font-size: 0.9rem; line-height: 1.4;">${message}</div>
                    <button type="button" class="btn-close ms-2" onclick="this.parentElement.parentElement.remove()"></button>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, type === 'error' ? 8000 : 6000);
        }
    </script>
</body>
</html>
