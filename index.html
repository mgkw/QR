<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>๐ ูุงุฑุฆ ุงูุจุงุฑููุฏ ุงูุนุงููู</title>
    <meta name="description" content="ูุธุงู ูุงุฑุฆ ุงูุจุงุฑููุฏ ุงููุฑูุฒู - ุงููุตูู ูู ุฃู ููุงู ูู ุงูุนุงูู">
    <meta name="keywords" content="barcode, QR code, scanner, ูุงุฑุฆ ุงูุจุงุฑููุฏ, ูุณุญ ุงูููุฏ">
    
    <!-- PWA Support -->
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ูุงุฑุฆ ุงูุจุงุฑููุฏ ุงูุนุงููู">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>๐ฑ</text></svg>">
    
    <!-- CSS Libraries -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    
    <style>
        /* ุฅุถุงูุงุช ุฎุงุตุฉ ูููุธุงู ุงูุนุงููู */
        .global-indicator {
            position: fixed;
            top: 20px;
            left: 20px;
            background: linear-gradient(45deg, #00c851, #00ff4d);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            z-index: 1000;
            animation: pulse 2s infinite;
        }
        
        .server-status {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            z-index: 1000;
            color: white;
        }
        
        .status-connected {
            background: linear-gradient(45deg, #00c851, #00ff4d);
            animation: pulse 2s infinite;
        }
        
        .status-local {
            background: linear-gradient(45deg, #ff9500, #ffad33);
        }
        
        .status-error {
            background: linear-gradient(45deg, #ff4444, #ff6666);
        }
        
        .welcome-banner {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 15px;
            text-align: center;
        }
        
        .sync-indicator {
            display: inline-block;
            margin-left: 10px;
            animation: spin 2s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .device-info {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 10px;
            border-radius: 10px;
            font-size: 0.8rem;
            opacity: 0.8;
        }
        
        .global-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .feature-card {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            backdrop-filter: blur(10px);
        }
        
        .feature-card i {
            font-size: 2rem;
            margin-bottom: 10px;
            color: #ffd43b;
        }
    </style>
</head>

<body>
    <!-- ูุคุดุฑุงุช ุงููุธุงู ุงูุนุงููู -->
    <div class="global-indicator">
        <i class="fas fa-globe"></i> ูุธุงู ุนุงููู
    </div>
    
    <div id="serverStatus" class="server-status status-connected">
        <i class="fas fa-server"></i> <span id="statusText">ูุชุตู</span>
    </div>
    
    <div class="device-info" id="deviceInfo">
        <i class="fas fa-mobile-alt"></i> <span id="deviceType">Unknown</span> | 
        <i class="fas fa-wifi"></i> <span id="connectionType">Online</span>
    </div>

    <div class="container">
        <!-- ุฑุณุงูุฉ ุงูุชุฑุญูุจ -->
        <div class="welcome-banner animate__animated animate__fadeInDown">
            <h2>
                <i class="fas fa-qrcode"></i> 
                ูุฑุญุจุงู ุจู ูู ูุงุฑุฆ ุงูุจุงุฑููุฏ ุงูุนุงููู
                <i class="fas fa-sync sync-indicator" id="syncIndicator" style="display: none;"></i>
            </h2>
            <p>ููููู ุงูุขู ุงููุตูู ูุจูุงูุงุชู ูู ุฃู ููุงู ูู ุงูุนุงูู ๐</p>
        </div>

        <!-- ุงููููุฒุงุช ุงูุนุงูููุฉ -->
        <div class="global-features">
            <div class="feature-card">
                <i class="fas fa-cloud"></i>
                <h4>ุชุฒุงูู ุณุญุงุจู</h4>
                <p>ุจูุงูุงุชู ูุญููุธุฉ ููุชุฒุงููุฉ ุนุงูููุงู</p>
            </div>
            <div class="feature-card">
                <i class="fas fa-mobile-alt"></i>
                <h4>ูุชูุงูู ูุน ุงูุฌูุงู</h4>
                <p>ูุนูู ุนูู ุฌููุน ุงูุฃุฌูุฒุฉ ูุงูููุตุงุช</p>
            </div>
            <div class="feature-card">
                <i class="fas fa-shield-alt"></i>
                <h4>ุญูุงูุฉ ูุชูุฏูุฉ</h4>
                <p>ูุธุงู ูุตุงุฏูุฉ ุขูู ููุดูุฑ</p>
            </div>
            <div class="feature-card">
                <i class="fas fa-bolt"></i>
                <h4>ุณุฑุนุฉ ูุงุฆูุฉ</h4>
                <p>ูุนุงูุฌุฉ ููุฑูุฉ ููุชุงุฆุฌ ุณุฑูุนุฉ</p>
            </div>
        </div>

        <!-- ูุงุฌูุฉ ุชุณุฌูู ุงูุฏุฎูู -->
        <div id="loginSection" class="card animate__animated animate__fadeInUp">
            <div class="card-header">
                <h2><i class="fas fa-sign-in-alt"></i> ุชุณุฌูู ุงูุฏุฎูู</h2>
                <p>ุงุฏุฎู ุฅูู ุงููุธุงู ุงูุนุงููู ููุฑุงุกุฉ ุงูุจุงุฑููุฏ</p>
            </div>
            
            <form id="loginForm" class="card-body" autocomplete="on">
                <div class="form-group">
                    <label for="username">
                        <i class="fas fa-user"></i> ุงุณู ุงููุณุชุฎุฏู
                    </label>
                    <input type="text" 
                           id="username" 
                           name="username"
                           required 
                           placeholder="ุงุฏุฎู ุงุณู ุงููุณุชุฎุฏู"
                           autocomplete="username"
                           class="form-control">
                </div>
                
                <div class="form-group">
                    <label for="password">
                        <i class="fas fa-lock"></i> ูููุฉ ุงููุฑูุฑ
                    </label>
                    <input type="password" 
                           id="password" 
                           name="password"
                           placeholder="ุงุฏุฎู ูููุฉ ุงููุฑูุฑ (ุงุฎุชูุงุฑู)"
                           autocomplete="current-password"
                           class="form-control">
                </div>
                
                <div class="form-group">
                    <label class="checkbox-container">
                        <input type="checkbox" id="rememberMe" name="rememberMe">
                        <span class="checkmark"></span>
                        ุชุฐูุฑูู ููุฏุฉ 30 ูููุงู
                    </label>
                </div>
                
                <button type="submit" class="btn btn-primary btn-block">
                    <i class="fas fa-sign-in-alt"></i> ุฏุฎูู
                </button>
            </form>
            
            <div class="card-footer">
                <p><strong>ุญุณุงุจุงุช ุชุฌุฑูุจูุฉ:</strong></p>
                <div class="demo-accounts">
                    <button class="btn btn-outline" onclick="quickLogin('admin', 'owner123')">
                        <i class="fas fa-crown"></i> admin (ูุฏูุฑ)
                    </button>
                    <button class="btn btn-outline" onclick="quickLogin('test', '')">
                        <i class="fas fa-user"></i> test (ุนุงุฏู)
                    </button>
                </div>
            </div>
        </div>

        <!-- ูุงุฌูุฉ ุงููุงุณุญ ุงูุถูุฆู -->
        <div id="scannerSection" class="card" style="display: none;">
            <div class="card-header">
                <div class="user-info">
                    <div class="user-details">
                        <span id="currentUser" class="username"></span>
                        <span id="userBadge" class="user-badge"></span>
                        <div class="connection-status">
                            <i class="fas fa-circle" id="connectionDot"></i>
                            <span id="connectionStatus">ูุชุตู ุจุงูุฎุงุฏู ุงูุนุงููู</span>
                        </div>
                    </div>
                    <div class="header-actions">
                        <button id="refreshBtn" class="btn btn-icon" title="ุชุญุฏูุซ">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                        <button id="settingsBtn" class="btn btn-icon" title="ุงูุฅุนุฏุงุฏุงุช">
                            <i class="fas fa-cog"></i>
                        </button>
                        <button id="logoutBtn" class="btn btn-icon btn-danger" title="ุชุณุฌูู ุงูุฎุฑูุฌ">
                            <i class="fas fa-sign-out-alt"></i>
                        </button>
                    </div>
                </div>
            </div>

            <div class="card-body">
                <!-- ุฅุญุตุงุฆูุงุช ุณุฑูุนุฉ -->
                <div class="stats-row" id="quickStats">
                    <div class="stat-item">
                        <span class="stat-number" id="totalScansCount">0</span>
                        <span class="stat-label">ุฅุฌูุงูู ุงููุณุญุงุช</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="todayScansCount">0</span>
                        <span class="stat-label">ุงูููู</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="activeUsersCount">0</span>
                        <span class="stat-label">ุงููุณุชุฎุฏููู ุงููุดุทูู</span>
                    </div>
                </div>

                <!-- ุฃุฒุฑุงุฑ ุงููุงููุฑุง -->
                <div class="camera-controls">
                    <button id="startCameraBtn" class="btn btn-success btn-block">
                        <i class="fas fa-camera"></i> ุชุดุบูู ุงููุงููุฑุง
                    </button>
                    <button id="stopCameraBtn" class="btn btn-danger btn-block" style="display: none;">
                        <i class="fas fa-stop"></i> ุฅููุงู ุงููุงููุฑุง
                    </button>
                </div>

                <!-- ููุทูุฉ ุงููุนุงููุฉ -->
                <div id="previewContainer" class="preview-container" style="display: none;">
                    <video id="preview" class="video-preview" autoplay muted playsinline></video>
                    <canvas id="canvas" class="scan-canvas"></canvas>
                    <div class="scan-overlay">
                        <div class="scan-frame"></div>
                        <div class="scan-line"></div>
                    </div>
                    <div class="scan-status" id="scanStatus">
                        <i class="fas fa-search"></i> ุฌุงุฑู ุงูุจุญุซ ุนู ุจุงุฑููุฏ...
                    </div>
                </div>

                <!-- ุฑูุน ุงูุตูุฑ -->
                <div class="upload-section">
                    <input type="file" id="imageUpload" accept="image/*" capture="environment" style="display: none;">
                    <button id="uploadBtn" class="btn btn-outline btn-block">
                        <i class="fas fa-upload"></i> ุฑูุน ุตูุฑุฉ
                    </button>
                </div>

                <!-- ูุชุงุฆุฌ ุงููุณุญ -->
                <div id="scanResults" class="scan-results" style="display: none;">
                    <h3><i class="fas fa-check-circle"></i> ูุชูุฌุฉ ุงููุณุญ</h3>
                    <div class="result-content">
                        <div class="result-image">
                            <img id="resultImage" alt="ุตูุฑุฉ ุงูุจุงุฑููุฏ">
                        </div>
                        <div class="result-details">
                            <div class="barcode-info">
                                <label>ุงูุจุงุฑููุฏ:</label>
                                <div class="barcode-value" id="barcodeValue"></div>
                                <button class="btn btn-icon copy-btn" onclick="copyBarcode()" title="ูุณุฎ">
                                    <i class="fas fa-copy"></i>
                                </button>
                            </div>
                            <div class="scan-info">
                                <small>
                                    <i class="fas fa-clock"></i> <span id="scanTime"></span> |
                                    <i class="fas fa-user"></i> <span id="scanUser"></span> |
                                    <i class="fas fa-server"></i> ูุญููุธ ูู ุงูุฎุงุฏู ุงูุนุงููู
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ุฅุฏุงุฑุฉ ุงููุณุญุงุช -->
        <div id="scansSection" class="card" style="display: none;">
            <div class="card-header">
                <h3><i class="fas fa-list"></i> ุฅุฏุงุฑุฉ ุงููุณุญุงุช</h3>
                <div class="header-actions">
                    <button id="exportBtn" class="btn btn-outline">
                        <i class="fas fa-download"></i> ุชุตุฏูุฑ
                    </button>
                    <button id="refreshScansBtn" class="btn btn-outline">
                        <i class="fas fa-sync-alt"></i> ุชุญุฏูุซ
                    </button>
                </div>
            </div>
            
            <div class="card-body">
                <!-- ููุงุชุฑ ุงูุจุญุซ -->
                <div class="filters-section">
                    <div class="filter-group">
                        <input type="text" id="searchFilter" placeholder="ุจุญุซ ูู ุงูุจุงุฑููุฏ..." class="form-control">
                    </div>
                    <div class="filter-group">
                        <select id="userFilter" class="form-control">
                            <option value="">ุฌููุน ุงููุณุชุฎุฏููู</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <input type="date" id="dateFilter" class="form-control">
                    </div>
                </div>

                <!-- ูุงุฆูุฉ ุงููุณุญุงุช -->
                <div id="scansList" class="scans-list">
                    <div class="loading-message">
                        <i class="fas fa-spinner fa-spin"></i> ุฌุงุฑู ุชุญููู ุงููุณุญุงุช ูู ุงูุฎุงุฏู ุงูุนุงููู...
                    </div>
                </div>
            </div>
        </div>

        <!-- ุงูุฅุนุฏุงุฏุงุช -->
        <div id="settingsSection" class="card" style="display: none;">
            <div class="card-header">
                <h3><i class="fas fa-cog"></i> ุงูุฅุนุฏุงุฏุงุช</h3>
            </div>
            
            <div class="card-body">
                <!-- ุฅุนุฏุงุฏุงุช ุงููุธุงู -->
                <div class="settings-group">
                    <h4><i class="fas fa-server"></i> ูุนูููุงุช ุงูุฎุงุฏู</h4>
                    <div class="server-info" id="serverInfo">
                        <div class="info-item">
                            <label>ููุน ูุงุนุฏุฉ ุงูุจูุงูุงุช:</label>
                            <span id="dbType">ุบูุฑ ูุญุฏุฏ</span>
                        </div>
                        <div class="info-item">
                            <label>ุงุณู ูุงุนุฏุฉ ุงูุจูุงูุงุช:</label>
                            <span id="dbName">ุบูุฑ ูุญุฏุฏ</span>
                        </div>
                        <div class="info-item">
                            <label>ุญุงูุฉ ุงูุงุชุตุงู:</label>
                            <span id="dbStatus">ุบูุฑ ูุญุฏุฏ</span>
                        </div>
                    </div>
                </div>

                <!-- ุฅุนุฏุงุฏุงุช ุงูุชููุฌุฑุงู -->
                <div class="settings-group" id="telegramSettings" style="display: none;">
                    <h4><i class="fab fa-telegram"></i> ุฅุนุฏุงุฏุงุช ุงูุชููุฌุฑุงู</h4>
                    <div class="form-group">
                        <label>ุฑูุฒ ุงูุจูุช:</label>
                        <input type="text" id="telegramToken" class="form-control" placeholder="Bot Token">
                    </div>
                    <div class="form-group">
                        <label>ูุนุฑู ุงููุญุงุฏุซุฉ:</label>
                        <input type="text" id="telegramChat" class="form-control" placeholder="Chat ID">
                    </div>
                    <div class="form-group">
                        <label class="checkbox-container">
                            <input type="checkbox" id="autoSendTelegram">
                            <span class="checkmark"></span>
                            ุฅุฑุณุงู ุชููุงุฆู ููุชููุฌุฑุงู
                        </label>
                    </div>
                    <button id="saveSettingsBtn" class="btn btn-primary">
                        <i class="fas fa-save"></i> ุญูุธ ุงูุฅุนุฏุงุฏุงุช
                    </button>
                </div>

                <!-- ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู -->
                <div id="userManagement" class="settings-group" style="display: none;">
                    <h4><i class="fas fa-users"></i> ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู</h4>
                    <div class="users-list" id="usersList">
                        <!-- ุณูุชู ููุคูุง ุฏููุงููููุงู -->
                    </div>
                    <button id="addUserBtn" class="btn btn-success">
                        <i class="fas fa-plus"></i> ุฅุถุงูุฉ ูุณุชุฎุฏู
                    </button>
                </div>
            </div>
        </div>

        <!-- ุงูุชููู ุงูุณููู -->
        <div class="bottom-nav">
            <button class="nav-item active" data-section="scanner">
                <i class="fas fa-qrcode"></i>
                <span>ุงููุณุญ</span>
            </button>
            <button class="nav-item" data-section="scans">
                <i class="fas fa-list"></i>
                <span>ุงููุณุญุงุช</span>
            </button>
            <button class="nav-item" data-section="settings">
                <i class="fas fa-cog"></i>
                <span>ุงูุฅุนุฏุงุฏุงุช</span>
            </button>
        </div>
    </div>

    <!-- ุงูุฑุณุงุฆู ุงูููุจุซูุฉ -->
    <div id="toast" class="toast"></div>
    
    <!-- ููุฏุงู ุงูุชุฃููุฏ -->
    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="confirmTitle">ุชุฃููุฏ</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <p id="confirmMessage">ูู ุฃูุช ูุชุฃูุฏุ</p>
            </div>
            <div class="modal-footer">
                <button id="confirmCancel" class="btn btn-outline">ุฅูุบุงุก</button>
                <button id="confirmOk" class="btn btn-danger">ุชุฃููุฏ</button>
            </div>
        </div>
    </div>

    <!-- JavaScript Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-cookie/3.0.5/js.cookie.min.js"></script>
    <script src="library-loader.js"></script>
    <script src="script.js"></script>
    
    <script>
        // ุฅุนุฏุงุฏุงุช ุฎุงุตุฉ ุจุงููุธุงู ุงูุนุงููู
        window.GLOBAL_CONFIG = {
            isGlobalSystem: true,
            apiBaseUrl: window.location.origin + '/api',
            wsBaseUrl: window.location.origin.replace('http', 'ws'),
            syncInterval: 30000, // 30 ุซุงููุฉ
            autoSync: true,
            showDeviceInfo: true
        };

        // ุฅุธูุงุฑ ูุนูููุงุช ุงูุฌูุงุฒ
        document.addEventListener('DOMContentLoaded', function() {
            updateDeviceInfo();
            startGlobalSync();
        });

        function updateDeviceInfo() {
            const deviceInfo = document.getElementById('deviceInfo');
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            const deviceType = isMobile ? 'ูุงุชู ุฐูู' : 'ููุจููุชุฑ';
            const isOnline = navigator.onLine ? 'ูุชุตู' : 'ุบูุฑ ูุชุตู';
            
            deviceInfo.innerHTML = `
                <i class="fas fa-${isMobile ? 'mobile-alt' : 'desktop'}"></i> ${deviceType} | 
                <i class="fas fa-${navigator.onLine ? 'wifi' : 'unlink'}"></i> ${isOnline}
            `;
        }

        function startGlobalSync() {
            if (!window.GLOBAL_CONFIG.autoSync) return;

            setInterval(async () => {
                try {
                    const response = await fetch('/status');
                    const data = await response.json();
                    updateServerStatus(data);
                } catch (error) {
                    console.error('ุฎุทุฃ ูู ุงููุฒุงููุฉ:', error);
                    updateServerStatus({ success: false });
                }
            }, window.GLOBAL_CONFIG.syncInterval);
        }

        function updateServerStatus(data) {
            const statusElement = document.getElementById('serverStatus');
            const statusText = document.getElementById('statusText');
            const syncIndicator = document.getElementById('syncIndicator');
            
            if (data.success || data.database) {
                statusElement.className = 'server-status status-connected';
                statusText.textContent = 'ูุชุตู';
                syncIndicator.style.display = 'inline-block';
                setTimeout(() => syncIndicator.style.display = 'none', 1000);
            } else {
                statusElement.className = 'server-status status-error';
                statusText.textContent = 'ุฎุทุฃ ูู ุงูุงุชุตุงู';
            }
        }

        // ุฏุงูุฉ ุชุณุฌูู ุฏุฎูู ุณุฑูุน
        function quickLogin(username, password) {
            document.getElementById('username').value = username;
            document.getElementById('password').value = password;
            document.getElementById('loginForm').dispatchEvent(new Event('submit'));
        }

        // ูุฑุงูุจุฉ ุญุงูุฉ ุงูุงุชุตุงู
        window.addEventListener('online', () => {
            updateDeviceInfo();
            showToast('ุชู ุงุณุชุนุงุฏุฉ ุงูุงุชุตุงู ุจุงูุฅูุชุฑูุช', 'success');
        });

        window.addEventListener('offline', () => {
            updateDeviceInfo();
            showToast('ุงููุทุน ุงูุงุชุตุงู ุจุงูุฅูุชุฑูุช', 'warning');
        });
    </script>
</body>
</html> 